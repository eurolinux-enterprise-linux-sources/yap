################################################################
# Build jpl.jar
################################################################

.SUFFIXES: .java .class

#
# default base directory for YAP installation
#
ROOTDIR = @prefix@
#
# where the binary should be
#
BINDIR = $(ROOTDIR)/bin
#
# where YAP should look for binary libraries
#
LIBDIR=$(ROOTDIR)/lib/Yap
#
# where YAP should look for architecture-independent Prolog libraries
#
SHAREDIR=$(ROOTDIR)/share
#
#
# You shouldn't need to change what follows.
#
INSTALL=@INSTALL@
INSTALL_DATA=@INSTALL_DATA@
INSTALL_PROGRAM=@INSTALL_PROGRAM@
SHELL=/bin/sh
RANLIB=@RANLIB@
srcdir=@srcdir@
SHLIB_CFLAGS=@SHLIB_CFLAGS@
SHLIB_SUFFIX=@SHLIB_SUFFIX@
#4.1VPATH=@srcdir@:@srcdir@/OPTYap
CWD=$(PWD)
#
JAVAC=@JAVAC@
JAR=@JAR@
JPLJAR=jpl.jar
TESTJAR=jpltest.jar

CLS=	jpl/Atom.java \
	jpl/Compound.java \
	jpl/Float.java \
	jpl/Integer.java \
	jpl/JRef.java \
	jpl/JPLException.java \
	jpl/JPL.java \
	jpl/PrologException.java \
	jpl/Query.java \
	jpl/Term.java \
	jpl/Util.java \
	jpl/Variable.java \
	jpl/Version.java

FLI=	jpl/fli/atom_t.java \
	jpl/fli/BooleanHolder.java \
	jpl/fli/DoubleHolder.java \
	jpl/fli/engine_t.java \
	jpl/fli/fid_t.java \
	jpl/fli/functor_t.java \
	jpl/fli/IntHolder.java \
	jpl/fli/Int64Holder.java \
	jpl/fli/LongHolder.java \
	jpl/fli/module_t.java \
	jpl/fli/ObjectHolder.java \
	jpl/fli/PointerHolder.java \
	jpl/fli/predicate_t.java \
	jpl/fli/Prolog.java \
	jpl/fli/qid_t.java \
	jpl/fli/StringHolder.java \
	jpl/fli/term_t.java

TEST=	jpl/test/Family.java \
	jpl/test/FetchBigTree.java \
	jpl/test/FetchLongList.java \
	jpl/test/Ga2.java \
	jpl/test/Ga.java \
	jpl/test/Garbo.java \
	jpl/test/Masstest.java \
	jpl/test/MaxObjects.java \
	jpl/test/ShadowA.java \
	jpl/test/ShadowB.java \
	jpl/test/SyntaxError.java \
	jpl/test/Test.java \
	jpl/test/TestJUnit.java \
	jpl/test/TestOLD.java

JAVA=$(CLS) $(FLI)
CLASSES=$(JAVA:.java=.class)

TESTCLASSES=$(TEST:.java=.class)

all:	$(JPLJAR)

$(JAVA):
	for f in $(CLS); do  cp $(srcdir)/$$f jpl ; done
	for f in $(FLI); do  cp $(srcdir)/$$f jpl/fli ; done
	for f in $(TEST); do  cp $(srcdir)/$$f jpl/test ; done

$(JPLJAR): $(JAVA)
	$(JAVAC) $(JAVA)
	$(JAR) cf $(JPLJAR) $(CLASSES)

$(TESTJAR):	$(JAVA)	$(TEST)
	$(JAVAC)  -classpath $(JPLJAR):$(JUNIT) $(TEST)
	$(JAR) cf $(JPL) $(TESTCLASSES)

clean::
	rm -f *~ $(CLASSES)

distclean: clean
	rm -r $(JPL)

install: $(JPLJAR)
	mkdir -p $(DESTDIR)$(SHAREDIR)/Yap
	$(INSTALL_DATA) $(JPLJAR) $(DESTDIR)$(SHAREDIR)/Yap

